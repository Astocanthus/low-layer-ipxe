server {
  listen 80;
  server_name _;
  
  # Basic authentication
  auth_basic "iPXE Server";
  auth_basic_user_file /etc/nginx/auth/.htpasswd;

  # System images directory
location /images/ {
  alias /var/www/images/;
  autoindex on;
  autoindex_exact_size off;
  autoindex_localtime on;
  
  # Headers for image files
  location ~* \.(iso|img|vmdk|qcow2)$ {
    add_header Content-Type "application/octet-stream";
    add_header Cache-Control "public, max-age=3600";
  }
}

  # Ignition files directory
location /ignition/ {
  alias /var/www/ignition/;
  autoindex on;
  autoindex_exact_size off;
  autoindex_localtime on;
  
  # Specific content-type for Ignition files
  location ~* \.ign$ {
    default_type "application/vnd.coreos.ignition+json";
    add_header Cache-Control "no-cache, no-store, must-revalidate" always;
  }
}

# Simple status page
location / {
  return 200 "iPXE Server - OK\nImages: /images/\nIgnition: /ignition/\n";
  add_header Content-Type text/plain;
}

# Security - block access to sensitive files
location ~ /\. {
  deny all;
}

location ~ /\.htpasswd {
  deny all;
}
}